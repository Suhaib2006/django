{% extends "Base.html" %}

{% block Title %}
Trial Balance
{% endblock %}

{% block Style %}
    {% load static %}
    <style>
        .main-nav-bar{
            flex-direction: column;
        }
        .menu-btn{
            display: none;
        }
        .mainbox{
            height: 90vh;
        }
        .nav-icon{
            color: white;
            text-decoration: none;
        }
        .scrl-box{
            max-height: 55vh;
            overflow-y: scroll;
        }
        .box{
            backdrop-filter: blur(80px);
            color: rgb(255, 115, 0);
            border-radius: 20px;
            border: 2px solid white;
        }
        .sig-box{
            text-transform: capitalize;
            border-radius: 10px;
            min-height: 8vh;
            margin-top: 4px;
            margin-bottom: 4px;
            border: 2px solid black;
            color: rgb(255, 255, 255);
        }
        .borderremove{
            background-color: gray !important;
        }

        .TableIn{
            transform: scaleY(1);
            transition: 0.6s;
        }
        .TableOut{
            transform: scaleY(0);
            position: absolute;
        }
        .text-Name_{
            color: grey;
        }
        .btn{
            color: black;
            background-color: orange;
            border-radius: 10px;
            height: 7vh;
            font-size: 20px;
        }
        @media (max-width:600px){
            .main-nav-bar{
                flex-direction: row;
            }
            .menu-btn{
                display: inline;
            }
            .display-menu{
                display: none;
            }
            .menu-icons-bar{
                position: absolute;
                top: 104%;
                left: 0%;
                backdrop-filter: blur(10px);
                height: 95vh;
                transition: 0.5s;
                display: inline;
            }
            .nav-icon{
                margin-top: 20px;
                font-size: 25px;
                margin-left: 20px;
            }

            .icon-box{
                display: flex;
                height: 80px;
                align-items: center;
            }
            .sig-box div h4{
                font-size: 22px;
            }
        }
    </style>
{% endblock %}

{% block Content %}
    {% include 'Navbar.html' with Project=Project %}
    <div class="mainbox row col-12">
        <div class="col-12 col-md-6" id="trial">
            {% if Trial %}
                <div class="row d-flex justify-content-center align-items-center" id="stock">
                    <h3 class="mt-3 col-11 text-capitalize box d-flex justify-content-center align-items-center text-center" style="height: 10vh;"><b>Trial balane of {{Project}}</b> </h3>
                    <div class="row col-11 d-flex justify-content-center align-items-center" >
                        <div class="col-6"><h3>Perticular</h3></div>
                        <div class="col-3"><h4>Dr</h3></div>
                        <div class="col-3"><h4>Cr</h3></div>
                    </div>
                    <div class="row col-11 scrl-box box mt-2  justify-content-center ">
                            {% for obj in Trial %}
                                {% if obj.amount != 0 %}
                                <div class="col-12 sig-box row d-flex justify-content-center align-items-center" id="{{obj.id}}" onclick="Mapdata('{{obj.id}}','{{obj.name}}','{{obj.sheet}}','{{obj.account_type}}')">
                                    
                                    <div class="col-5 mt-1"><h5>{{obj.name}}</h5></div>
                                    {% if obj.state == "DR" %}
                                        <div class="col-3 mt-1"><h5>{{obj.amount|floatformat:-2}}</h5></div>
                                        <div class="col-3 mt-1"><h5></h5></div>
                                    {% else %}
                                        <div class="col-3 mt-1"><h5></h5></div>
                                        <div class="col-3 mt-1"><h5>{{obj.amount|floatformat:-2}}</h5></div>
                                    {% endif %}

                                    <div class="col-1">
                                        {% if obj.sheet == "Choose..." or obj.account_type == "Choose..." %}
                                            <div id="icon{{obj.name}}">
                                                <svg id="icon{{obj.name}}" xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-plus-square-dotted" viewBox="0 0 16 16">
                                                    <path d="M2.5 0q-.25 0-.487.048l.194.98A1.5 1.5 0 0 1 2.5 1h.458V0zm2.292 0h-.917v1h.917zm1.833 0h-.917v1h.917zm1.833 0h-.916v1h.916zm1.834 0h-.917v1h.917zm1.833 0h-.917v1h.917zM13.5 0h-.458v1h.458q.151 0 .293.029l.194-.981A2.5 2.5 0 0 0 13.5 0m2.079 1.11a2.5 2.5 0 0 0-.69-.689l-.556.831q.248.167.415.415l.83-.556zM1.11.421a2.5 2.5 0 0 0-.689.69l.831.556c.11-.164.251-.305.415-.415zM16 2.5q0-.25-.048-.487l-.98.194q.027.141.028.293v.458h1zM.048 2.013A2.5 2.5 0 0 0 0 2.5v.458h1V2.5q0-.151.029-.293zM0 3.875v.917h1v-.917zm16 .917v-.917h-1v.917zM0 5.708v.917h1v-.917zm16 .917v-.917h-1v.917zM0 7.542v.916h1v-.916zm15 .916h1v-.916h-1zM0 9.375v.917h1v-.917zm16 .917v-.917h-1v.917zm-16 .916v.917h1v-.917zm16 .917v-.917h-1v.917zm-16 .917v.458q0 .25.048.487l.98-.194A1.5 1.5 0 0 1 1 13.5v-.458zm16 .458v-.458h-1v.458q0 .151-.029.293l.981.194Q16 13.75 16 13.5M.421 14.89c.183.272.417.506.69.689l.556-.831a1.5 1.5 0 0 1-.415-.415zm14.469.689c.272-.183.506-.417.689-.69l-.831-.556c-.11.164-.251.305-.415.415l.556.83zm-12.877.373Q2.25 16 2.5 16h.458v-1H2.5q-.151 0-.293-.029zM13.5 16q.25 0 .487-.048l-.194-.98A1.5 1.5 0 0 1 13.5 15h-.458v1zm-9.625 0h.917v-1h-.917zm1.833 0h.917v-1h-.917zm1.834-1v1h.916v-1zm1.833 1h.917v-1h-.917zm1.833 0h.917v-1h-.917zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3z"/>
                                                </svg>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endif %}
                            {% endfor %}
                    </div>
                    <div class="row col-11 box mt-2 d-flex justify-content-center align-items-center" style="height: 10vh;">
                        <div class="col-6"><h3>{{Tally}}</h3></div>
                        <div class="col-6 text-center"><h3>{{Amount|floatformat:-2}}</h3></div>
                    </div>
                </div>
                {% else %}
                    <div class="d-flex justify-content-center col-12" style="height: 80vh; align-items: center; overflow:hidden; "></div>
                        <h2 class="text-center col-12">Data Is Not Founted <br>Please Enter Jornal Entry's And Your Ledger Account vist</h2>
                    </div>
                {% endif %}
        </div>
        <div class="col-md-6" id="blagspace">
            <div class=" col-12 d-flex justify-content-center align-items-center flex-column" style="height: 90vh;">
                <!---->
                <div class="text-start col-12 TableIn" id="pdftrial">
                    <h2 style="color: orange;"><b>TrialBalance </b></h2>
                    <h4 style="color: rgb(224, 224, 224);">A ledger account is a record of all trasactions related to a specific account in a business.It is part of the general ledger, which contains all financial data used to prepare the company's financial statement</h4>
                    <br>
                    {% if Tally == "Tally" %}
                    <h4 style="color: rgb(224, 224, 224);" class="mb-2">Do you wish to get your current Trial balance statement? yes, please click below </h4>
                    <button type="button" class="ms-1 rounded-5  btn-danger col-3 row" onclick="Trialpdf('{{Project}}')">
                        <h4 class="">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-filetype-pdf " viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M14 4.5V14a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM1.6 11.85H0v3.999h.791v-1.342h.803q.43 0 .732-.173.305-.175.463-.474a1.4 1.4 0 0 0 .161-.677q0-.375-.158-.677a1.2 1.2 0 0 0-.46-.477q-.3-.18-.732-.179m.545 1.333a.8.8 0 0 1-.085.38.57.57 0 0 1-.238.241.8.8 0 0 1-.375.082H.788V12.48h.66q.327 0 .512.181.185.183.185.522m1.217-1.333v3.999h1.46q.602 0 .998-.237a1.45 1.45 0 0 0 .595-.689q.196-.45.196-1.084 0-.63-.196-1.075a1.43 1.43 0 0 0-.589-.68q-.396-.234-1.005-.234zm.791.645h.563q.371 0 .609.152a.9.9 0 0 1 .354.454q.118.302.118.753a2.3 2.3 0 0 1-.068.592 1.1 1.1 0 0 1-.196.422.8.8 0 0 1-.334.252 1.3 1.3 0 0 1-.483.082h-.563zm3.743 1.763v1.591h-.79V11.85h2.548v.653H7.896v1.117h1.606v.638z"/>
                            </svg>
                            PDF
                        </h4>
                    </button>
                    {%  endif %}    
                </div> 

                <div id="formpage" class="TableOut text-start col-8 box d-flex  flex-column p-3" style="height: 80vh;">
                    <h2 class="mt-3 text-center text-capitalize pb-4 border-2 border-bottom" id="AccountName"></h2>
                    <div class="col-12 mb-1 mt-4">
                        <label for=""><h4 class="text-Name_">Balance/Incomstatment</h4></label>
                        <select onchange="optionsorting()" class="form-select" id="inputGroupSelect03" name="Incomstatement" aria-label="Example select with button addon" style="height: 7vh; border-radius: 10px; font-size: 20px;">
                            <option selected>Choose...</option>
                            <option value="Balance Sheet" >Balance Sheet</option>
                            <option value="{{incomstatement}}" >{{incomstatement}} statement</option>
                        </select>
                    </div>

                    <div class="col-12 mb-1 mt-2 d-flex flex-column justify-content-center" >
                        <label for=""><h4 class="text-Name_">Account Type</h4></label>
                            <select class="form-select d-none" id="incomstatement" name="statement" aria-label="Example select with button addon" style="height: 7vh; border-radius: 10px; font-size: 20px;" onchange="btnvisible()">
                                <option selected>Choose...</option>
                                    {% if incomstatement == "Manufacturing" %}
                                        <option value="Direct Income">Direct Income</option>
                                        <option value="Direct Expenses">Direct Expenses</option>
                                        <option value="Manufacturing Expenses">Manufacturing Expenses</option>
                                        <option value="Factory Overheads">Factory Overheads</option>
                                        <option value="Indirect Expenses">Indirect Expenses</option>
                                        <option value="Indirect Income">Indirect Income</option>
                                    {% elif incomstatement == "NormalTrade" %}
                                        <option value="Opening Stock">Opening Stock</option>
                                        <option value="Direct Expense">Direct Expense</option>
                                        <option value="Indirect Expense">Indirect Expense</option>
                                        <option value="Indirect Income">Indirect Income</option>
                                    {% else %}
                                        <option value="Opening Stock">Opening Stock</option>
                                        <option value="Receipt">Receipt</option>
                                        <option value="Disbursement">Disbursement</option>
                                    {% endif %}
                            </select>
                            <select class="form-select d-none" id="Balance_Sheet" name="statement" aria-label="Example select with button addon" style="height: 7vh; border-radius: 10px; font-size: 20px;" onchange="btnvisible()">
                                <option selected>Choose...</option>
                                <option value="Current Assets">Current Assets</option>
                                <option value="Sundry Deptors">Sundry Deptors</option>
                                <option value="Sundry Crediters">Sundry Crediters</option>
                                <option value="Fixed Assets">Fixed Assets</option>
                                <option value="Investment">Investment</option>
                                <option value="Loan Given">Loan Given</option>
                                <option value="Adjestment">Adjestment</option>
                                <option value="Equity Capital">Equity Capital</option>
                            </select>
                            <div class="error d-flex align-items-center"  style="height: 5vh;"><h6 id="status" class="mt-4"></h6></div>
                        <button id="btn-submit" class="btn mt-4 col-5 ms-1" onclick="SubmitFunction('{{Project}}')" disabled=True> Submit</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
{% endblock %}

{% block Script %}
        <script>
            function menubar(){
                document.getElementById('menu_bar').className="menu-icons-bar"
                document.getElementById('trial').className="d-none"
                document.getElementById('blagspace').className="d-none"
            }

            function Mapdata(id,name,sheet,account_type){
                //const item=document.getElementById(id).classList.toggle("borderremove");
                st=localStorage.getItem("ID")
                console.log(name);
                document.getElementById('inputGroupSelect03').value=sheet
                const Balance=document.getElementById("Balance_Sheet")
                const income=document.getElementById("incomstatement")
                const Data=document.getElementById('inputGroupSelect03').value
                
                if(sheet!="Choose..."){
                    if(sheet=="Balance Sheet"){
                        Balance.classList.remove("d-none")
                        Balance.value=account_type
                        income.classList.add("d-none")
                    }else{
                        income.classList.remove("d-none")
                        income.value=account_type
                        Balance.classList.add("d-none")
                    }
                }else{
                    Balance.classList.add("d-none")
                    income.classList.add("d-none")
                }
                document.getElementById('btn-submit').disabled=true

                if(st!=id){
                    localStorage.setItem("ID",id)
                    document.getElementById("AccountName").innerText=name
                    document.getElementById('formpage').classList.replace("TableOut","TableIn")
                    document.getElementById('pdftrial').classList.replace("TableIn","TableOut")
                }else{
                    localStorage.setItem("ID",0)
                    document.getElementById('pdftrial').classList.replace("TableOut","TableIn")
                    document.getElementById('formpage').classList.replace("TableIn","TableOut")
                }
            }

            function Trialpdf(Project){
                window.location.href=`/Pdf/${Project}/TrialBalance`;
            }
            
            function SubmitFunction(Project){
                const Statement=document.getElementById("inputGroupSelect03").value
                let Finalvalue=''
                const AccountName=document.getElementById("AccountName").innerText.toLocaleLowerCase()
                if (Statement=="Balance Sheet"){
                    Finalvalue=document.getElementById("Balance_Sheet").value
                }
                else{
                    Finalvalue=document.getElementById("incomstatement").value
                }
                console.log(AccountName);

                fetch(`/Statement/${Project}/`,{
                    method: "POST",
                    headers:{
                        "Content-Type":'application/json',
                        "X-CSRFToken":"{{ csrf_token }}",
                    },
                    body:JSON.stringify(
                        {
                            Name:AccountName,
                            Statement:Statement,
                            Type:Finalvalue,
                        }
                    )
                })
                .then(res=>res.json())
                .then(data=>{
                    document.getElementById('status').innerText=data.status
                    document.getElementById('btn-submit').disabled=true
                    const Isha=document.getElementById(`icon${AccountName}`)
                    if(Isha){
                        Isha.classList.add("d-none")
                    }
                    alert(data.status)
                })

            }
            function optionsorting(){
                const Data=document.getElementById('inputGroupSelect03').value
                const Balance=document.getElementById("Balance_Sheet")
                const income=document.getElementById("incomstatement")
                if(Data!="Choose..."){
                    if(Data=="Balance Sheet"){
                        Balance.value="Choose..."
                        Balance.classList.remove("d-none")
                        income.classList.add("d-none")
                    }else{
                        income.value="Choose..."
                        income.classList.remove("d-none")
                        Balance.classList.add("d-none")
                    }
                }else{
                    Balance.value="Choose..."
                    income.value="Choose..."
                    Balance.classList.add("d-none")
                    income.classList.add("d-none")
                }
                document.getElementById('btn-submit').disabled=true
            }
            function btnvisible(){
                const Data=document.getElementById("inputGroupSelect03").value
                if (Data=="Balance Sheet") {
                    const Balance=document.getElementById("Balance_Sheet").value
                    if(Balance!="Choose..."){document.getElementById('btn-submit').disabled=false}
                    else{document.getElementById('btn-submit').disabled=true}
                }else{
                    const income=document.getElementById("incomstatement").value
                    if(income!="Choose..."){document.getElementById('btn-submit').disabled=false}
                    else{document.getElementById('btn-submit').disabled=true}
                }
            }
        </script>
{% endblock %}